{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/dokuntag/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClient | undefined;\n}\n\nexport const prisma =\n  global.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') {\n  global.prisma = prisma;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SACX,OAAO,MAAM,IACb,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/dokuntag/lib/password.ts"],"sourcesContent":["/**\n * Password hashing and verification using bcryptjs\n * Secure password storage with bcrypt algorithm\n */\n\nimport bcrypt from 'bcryptjs';\n\nconst SALT_ROUNDS = 10;\n\n/**\n * Hash a plain text password using bcryptjs\n */\nexport async function hashPassword(password: string): Promise<string> {\n  if (!password || password.length < 6) {\n    throw new Error('Şifre en az 6 karakter olmalı');\n  }\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\n/**\n * Compare plain text password with hash\n */\nexport async function comparePassword(\n  plainPassword: string,\n  hash: string\n): Promise<boolean> {\n  return bcrypt.compare(plainPassword, hash);\n}\n\n/**\n * Check if a hash is a placeholder (existing users migrated without real passwords)\n */\nexport function isPlaceholderHash(hash: string): boolean {\n  return hash.includes('placeholder');\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;;CAGC,GAED;;AAEA,MAAM,cAAc;AAKb,eAAe,aAAa,QAAgB;IACjD,IAAI,CAAC,YAAY,SAAS,MAAM,GAAG,GAAG;QACpC,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAKO,eAAe,gBACpB,aAAqB,EACrB,IAAY;IAEZ,OAAO,8IAAM,CAAC,OAAO,CAAC,eAAe;AACvC;AAKO,SAAS,kBAAkB,IAAY;IAC5C,OAAO,KAAK,QAAQ,CAAC;AACvB"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/dokuntag/app/api/user/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { hashPassword } from '@/lib/password';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const userId = req.nextUrl.searchParams.get('id');\n    if (!userId) {\n      return NextResponse.json({ error: 'User ID required' }, { status: 400 });\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        loyaltyPoint: true,\n        rewardClaims: { include: { reward: true } },\n      },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    return NextResponse.json(user);\n  } catch (error) {\n    console.error('GET /api/user error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { id, email, name, password } = await req.json();\n\n    if (!id || !email || !name || !password) {\n      return NextResponse.json(\n        { error: 'ID, email, name, and password required' },\n        { status: 400 }\n      );\n    }\n\n    // Hash password\n    const passwordHash = await hashPassword(password);\n\n    const user = await prisma.user.create({\n      data: { \n        id, \n        email, \n        name,\n        passwordHash,\n        role: 'user',\n      },\n    });\n\n    // Create loyalty points for new user\n    await prisma.loyaltyPoint.create({\n      data: { userId: id, points: 0 },\n    });\n\n    // Return user without passwordHash\n    const { passwordHash: _, ...userWithoutPassword } = user;\n    return NextResponse.json(userWithoutPassword, { status: 201 });\n  } catch (error) {\n    console.error('POST /api/user error:', error);\n    return NextResponse.json(\n      { error: 'Failed to create user' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(req: NextRequest) {\n  try {\n    const { id, ...data } = await req.json();\n\n    if (!id) {\n      return NextResponse.json({ error: 'User ID required' }, { status: 400 });\n    }\n\n    const user = await prisma.user.update({\n      where: { id },\n      data,\n    });\n\n    // Return user without passwordHash\n    const { passwordHash: _, ...userWithoutPassword } = user;\n    return NextResponse.json(userWithoutPassword);\n  } catch (error) {\n    console.error('PUT /api/user error:', error);\n    return NextResponse.json(\n      { error: 'Failed to update user' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,SAAS,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAC5C,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI;YAAO;YACpB,SAAS;gBACP,cAAc;gBACd,cAAc;oBAAE,SAAS;wBAAE,QAAQ;oBAAK;gBAAE;YAC5C;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEpD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,MAAM,eAAe,MAAM,IAAA,iIAAY,EAAC;QAExC,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ;gBACA;gBACA;gBACA;gBACA,MAAM;YACR;QACF;QAEA,qCAAqC;QACrC,MAAM,yHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YAC/B,MAAM;gBAAE,QAAQ;gBAAI,QAAQ;YAAE;QAChC;QAEA,mCAAmC;QACnC,MAAM,EAAE,cAAc,CAAC,EAAE,GAAG,qBAAqB,GAAG;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC,qBAAqB;YAAE,QAAQ;QAAI;IAC9D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,GAAG,MAAM,IAAI,IAAI;QAEtC,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,OAAO;gBAAE;YAAG;YACZ;QACF;QAEA,mCAAmC;QACnC,MAAM,EAAE,cAAc,CAAC,EAAE,GAAG,qBAAqB,GAAG;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}